#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Autogenerated by Ansible. Manual changes may be overwritten.
# vim: ft=python ts=2:sts=2:sw=2:et

import imaplib
import sys
import os
import yaml


def read_config():
    """
    Read config from yaml file.

    YAML config is read from ~/.newmailrc file.
    The file should contain three key/value pairs:
      hostname: 'hostname'
      username: 'username'
      password: 'password'
    """
    with open(os.path.join(os.environ['HOME'], '.newmailrc'), 'r') as stream:
        return yaml.load(stream)


def main():
    """Run main script logic."""

    config = read_config()

    obj = imaplib.IMAP4_SSL(config['hostname'], '993')
    obj.login(config['username'], config['password'])
    obj.select()

    count = len(obj.search(None, 'UnSeen')[1][0].split())

    print(count)

    if count > 0:
        sys.exit(33)


if __name__ == "__main__":
    main()
