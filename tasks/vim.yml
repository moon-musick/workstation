---
- name: ensure vim packages installed
  apt: >
    name={{ item }}
    state=present
  with_items:
    - vim-nox
    - vim-gtk
    - git
    - cmake
    - ack-grep
    - silversearcher-ag
    - exuberant-ctags
    - build-essential
    - python-dev # ctrlp-cmatcher
    # - ghc-mod
    # - hdevtools
  tags:
  - shelltools
  - dev
  - vim

# apparently the module returns 'changed' on every checkout
# even if remote was not updated in any way
- name: ensure vim repo cloned
  git: >
    repo={{ vim_repo }}
    dest=/home/{{ user }}/.vim
    accept_hostkey=yes
    track_submodules=no
  changed_when: False
  sudo_user: "{{ user }}"
  tags:
  - shelltools
  - dev
  - vim

# FIXME; test termination issues
- name: ensure plugins installed
  shell: vim -u custom/vundle.vim +PluginInstall +qall
  args:
    creates: /home/{{ user }}/.vim/bundle/YouCompleteMe
    chdir: /home/{{ user }}/.vim
  sudo_user: "{{ user }}"
  tags:
  - shelltools
  - dev
  - vim

# - name: ensure other dependencies installed
#   TODO; gem install rcodetools # vim-xmpfilter
  tags:
  - shelltools
  - dev
  - vim

- name: ensure vim setup script run
  command: "/home/{{ user }}/.vim/install.sh"
  args:
    creates: "/home/{{ user }}/.vim/install.lock"
  sudo_user: "{{ user }}"
  tags:
  - shelltools
  - dev
  - vim

- name: ensure vimrc symlink created
  file: >
    src=/home/{{ user }}/.vim/.vimrc
    path=/home/{{ user }}/.vimrc
    owner={{ user }}
    group={{ user }}
    state=link
  tags:
  - shelltools
  - dev
  - vim
